# Flyers PWA (frontend)

Progressive web application for collecting anonymous GPS tracks and replaying shared activity on a MapLibre map. Built with React + Vite and integrates with Amplify (AppSync + DynamoDB).

## Scripts

- `npm run dev` – start Vite dev server
- `npm run build` – type-check and produce optimized build
- `npm run preview` – preview production build locally
- `npm run lint` – run ESLint (tree-shake ready)

## Environment variables

Create `frontend/.env` (or `.env.local`) with:

```
VITE_AWS_REGION=ap-northeast-1
VITE_APPSYNC_URL=https://xxxxxx.appsync-api.ap-northeast-1.amazonaws.com/graphql
VITE_COGNITO_IDENTITY_POOL_ID=ap-northeast-1:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

Populate the values from the Amplify outputs after `amplify push`. Until real values are provided the app will not be able to reach the backend.

## Amplify integration quick steps

1. `amplify init`
2. `amplify add auth` – choose *Identity Pool only* with unauthenticated guest access.
3. `amplify add api` – GraphQL. Import `frontend/src/amplify/schema.graphql` (create this file from the schema in `src/amplify/graphql.ts`) or paste directly. Enable DynamoDB resolvers for Session/TrackPoint.
4. `amplify push`
5. Replace `frontend/src/aws-exports.ts` with the generated configuration or map the environment variables accordingly.

## Feature overview

- Nickname prompt with local device ID persistence
- Continuous geolocation capture with 15s bulk flush to AppSync
- Live polling of other participants (configurable window)
- Manual history query with time range replay overlay
- MapLibre visualization with self path, peer tracks, and playback markers
- PWA ready (installable, offline-first shell)

## Technical notes

- Geolocation buffering handled via `useTrackRecorder` hook (in-memory; ready for IndexedDB extension)
- GraphQL interactions encapsulated in `src/services/appsyncService.ts`
- Map rendering via `src/components/MapView.tsx` with dedicated sources/layers
- Service worker & manifest generated by `vite-plugin-pwa`
